<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è‹±è¯­æ‰“å­—ç»ƒä¹ ï¼ˆ30å¤© + å¤ä¹  + æ˜Ÿæ˜Ÿå¥–åŠ±ï¼‰</title>

  <style>
    body{
      font-family: Arial,"PingFang SC","Microsoft YaHei",sans-serif;
      background:#f3f4f6;
      margin:0;
      padding:22px 12px;
      color:#111827;
    }
    .wrap{
      max-width:1050px;
      margin:0 auto;
      background:#fff;
      border-radius:18px;
      padding:18px 16px;
      box-shadow:0 10px 24px rgba(0,0,0,.08);
    }
    .top{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:12px;
    }
    .title{font-weight:900;font-size:20px; line-height:1.2;}
    .sub{
      margin-top:6px; font-size:14px; color:#6b7280; font-weight:600;
      display:inline-block; padding:6px 10px; border-radius:12px;
      background:#f3f4f6; border:1px solid #e5e7eb;
    }
    .controls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;
    }
    select,button{
      padding:10px 12px; border-radius:12px; border:1px solid #d1d5db;
      background:#fff; font-size:14px; cursor:pointer;
    }
    button.primary{background:#111827; color:#fff; border-color:#111827;}
    button.warn{background:#b91c1c; color:#fff; border-color:#b91c1c;}
    button:disabled{opacity:.55; cursor:not-allowed;}
    .grid{
      display:grid; grid-template-columns: 1.25fr .75fr; gap:14px;
    }
    @media(max-width:900px){ .grid{grid-template-columns:1fr;} }
    .card{
      background:#f9fafb; border:1px solid #e5e7eb; border-radius:18px; padding:16px;
    }
    .en{font-size:34px;font-weight:900;margin:0 0 6px 0;}
    .cn{font-size:16px;color:#6b7280;margin:0 0 12px 0;}
    .input{
      width:100%; font-size:22px; padding:14px;
      border-radius:14px; border:2px solid #e5e7eb; outline:none; box-sizing:border-box;
    }
    .input:focus{border-color:#111827;}
    .hint{margin-top:10px;font-size:14px; line-height:1.6;}
    .ok{color:#16a34a; font-weight:900;}
    .bad{color:#dc2626; font-weight:900;}
    .soft{color:#6b7280;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:10px;}
    .stats{display:flex; gap:12px; flex-wrap:wrap; font-size:13px; color:#374151;}
    .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;flex:1;min-width:220px;}
    .bar{height:100%;width:0%;background:#111827;transition:width .2s ease;}
    .mini{font-size:12px;color:#6b7280;margin-top:10px;}
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:8px 10px; border-radius:999px; background:#fff;
      border:1px solid #e5e7eb; margin:6px 6px 0 0; font-size:12px;
    }
    .side h3{margin:0 0 10px 0; font-size:14px;}
    .list{margin-top:10px; max-height:360px; overflow:auto; border:1px solid #e5e7eb; border-radius:14px; background:#fff;}
    .item{padding:10px 12px; border-bottom:1px solid #f3f4f6;}
    .item:last-child{border-bottom:none;}
    .item .a{font-weight:900;}
    .item .b{color:#6b7280;font-size:12px;margin-top:4px;}
    .item .meta{margin-top:6px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .tag{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#374151;}
    .tag.bad{border-color:#fecaca;background:#fee2e2;color:#991b1b;}
    .tag.ok{border-color:#bbf7d0;background:#dcfce7;color:#166534;}
    .divider{height:1px;background:#e5e7eb;margin:14px 0;}
    textarea{
      width:100%; height:110px; resize:vertical;
      padding:10px 12px; border-radius:14px; border:1px solid #d1d5db;
      font-size:13px; box-sizing:border-box; outline:none;
    }

    /* â­ æ˜Ÿæ˜Ÿå¥–åŠ± */
    .rewardBox{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      padding:10px 12px; border-radius:16px;
      background:#fff; border:1px solid #e5e7eb;
    }
    .stars{
      font-size:18px; font-weight:900;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      border:1px solid #e5e7eb; background:#f9fafb; font-size:12px;
    }
    .toast{
      position:fixed; left:50%; top:18px; transform:translateX(-50%);
      background:#111827; color:#fff; padding:10px 14px;
      border-radius:14px; box-shadow:0 12px 26px rgba(0,0,0,.18);
      opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease;
      z-index:9999;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(4px);}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="title">è‹±è¯­æ‰“å­—ç»ƒä¹ ï¼ˆ30å¤© + å¤ä¹ ä¸ç†Ÿç»ƒ + â­å¥–åŠ±ï¼‰</div>
        <div class="sub">æœ±å“¥å“¥ï¼Œæœ±å¦¹å¦¹ä½ ä»¬è¦åŠªåŠ›å­¦ä¹ ï¼åŠ æ²¹ï¼çˆ¸çˆ¸çˆ±ä½ ä»¬ï¼ â¤ï¸</div>
      </div>

      <div class="controls">
        <label class="soft">é€‰æ‹©ï¼š</label>
        <select id="modeSelect"></select>
        <button id="prevBtn">ä¸Šä¸€æ¡</button>
        <button id="nextBtn">ä¸‹ä¸€æ¡</button>
        <button id="speakBtn" class="primary">ğŸ”Š æœ—è¯»</button>
        <button id="markBtn">â­ åŠ å…¥å¤ä¹ </button>
        <button id="resetBtn">é‡ç½®å½“å‰åˆ—è¡¨</button>
      </div>
    </div>

    <div class="grid">
      <!-- Main -->
      <div class="card">
        <div class="rewardBox">
          <div class="stars">â­ æ˜Ÿæ˜Ÿï¼š<span id="starTotal">0</span></div>
          <div class="badge">ğŸ”¥ è¿å‡»ï¼š<span id="streakEl">0</span></div>
          <div class="badge">ğŸ¯ ä»Šæ—¥ç›®æ ‡ï¼š<span id="goalEl">20</span> â­</div>
          <button id="setGoalBtn">è®¾ç½®ç›®æ ‡</button>
          <button id="clearStarsBtn" class="warn">æ¸…ç©ºæ˜Ÿæ˜Ÿ</button>
        </div>

        <div class="divider"></div>

        <div class="en" id="enText">loading...</div>
        <div class="cn" id="cnText"></div>

        <input class="input" id="inputEl" placeholder="è¾“å…¥è‹±æ–‡ï¼ˆå¿½ç•¥å¤§å°å†™/å¤šç©ºæ ¼/é¦–å°¾ç©ºæ ¼ï¼‰" autocomplete="off"/>

        <div class="hint" id="hintEl"></div>

        <div class="row">
          <div class="stats">
            <div>è¿›åº¦ï¼š<b id="posEl">0</b>/<b id="totalEl">0</b></div>
            <div>æ­£ç¡®ï¼š<b id="correctEl">0</b></div>
            <div>é”™è¯¯ï¼š<b id="wrongEl">0</b></div>
            <div>æ­£ç¡®ç‡ï¼š<b id="accEl">0%</b></div>
          </div>
          <div class="progress"><div class="bar" id="barEl"></div></div>
        </div>

        <div class="mini">
          æç¤ºï¼šæŒ‰ <b>Enter</b> æäº¤ï¼›æ‰“å¯¹ä¼šè‡ªåŠ¨ä¸‹ä¸€æ¡ï¼›é”™äº†ä¼šæç¤ºå¹¶è®°å½•ã€‚ä½ ä¹Ÿå¯ä»¥ç‚¹ â­ åŠ å…¥â€œå¤ä¹ ä¸ç†Ÿç»ƒâ€ã€‚  
        </div>

        <div class="divider"></div>

        <div style="font-weight:900;margin-bottom:8px;">â• è‡ªå·±æ·»åŠ å†…å®¹ï¼ˆå¯é€‰ï¼‰</div>
        <textarea id="customArea" placeholder="æ¯è¡Œä¸€æ¡ï¼šè‹±æ–‡=ä¸­æ–‡
ä¾‹å¦‚ï¼š
apple=è‹¹æœ
I like coffee=æˆ‘å–œæ¬¢å’–å•¡"></textarea>
        <div class="controls" style="margin-top:10px;">
          <button id="loadCustomBtn">åŠ è½½åˆ°ã€Œè‡ªå®šä¹‰ã€</button>
          <button id="clearCustomBtn" class="warn">æ¸…ç©ºè‡ªå®šä¹‰</button>
          <button id="clearAllBtn" class="warn">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
        </div>
        <div class="mini">è‡ªå®šä¹‰å†…å®¹åŠ è½½åï¼Œä¼šå‡ºç°åœ¨é€‰æ‹©åˆ—è¡¨é‡Œï¼š<b>è‡ªå®šä¹‰</b>ï¼Œä¹Ÿä¼šè¿›å…¥å¤ä¹ æ± ã€‚</div>
      </div>

      <!-- Side -->
      <div class="card side">
        <h3>å¤ä¹ é¢æ¿</h3>
        <div>
          <span class="pill">â­ æ ‡è®°ä¸ç†Ÿç»ƒï¼š<b id="markCount">0</b></span>
          <span class="pill">âŒ æœ‰é”™è¯¯è®°å½•ï¼š<b id="wrongCount">0</b></span>
          <span class="pill">ğŸ“Œ å½“å‰æ¨¡å¼ï¼š<b id="modeName">-</b></span>
        </div>

        <div class="divider"></div>

        <h3>ä¸ç†Ÿç»ƒæ¸…å•ï¼ˆå½“å‰é€‰æ‹©ï¼‰</h3>
        <div class="list" id="reviewList"></div>

        <div class="mini">
          ä½ å¯ä»¥é€‰æ‹©ï¼š  
          - <b>å¤ä¹ ï¼ˆå½“å¤©ä¸ç†Ÿç»ƒï¼‰</b>ï¼šåªç»ƒä»Šå¤©/å½“å‰åˆ—è¡¨é‡Œè–„å¼±é¡¹  
          - <b>å¤ä¹ ï¼ˆå…¨å±€ä¸ç†Ÿç»ƒï¼‰</b>ï¼šå¤ä¹ æ‰€æœ‰å¤©/æ‰€æœ‰åˆ—è¡¨è–„å¼±é¡¹  
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* =========================
   A) å­¦ä¹ å†…å®¹ï¼š30å¤© + å°å­¦å…­å¹´çº§ï¼ˆå¯ç»§ç»­æ‰©å±•ï¼‰
   ========================= */
const DAYS = {
  "Day 1":[
    {en:"hello",cn:"ä½ å¥½"},
    {en:"thank you",cn:"è°¢è°¢"},
    {en:"sorry",cn:"å¯¹ä¸èµ·"},
    {en:"please",cn:"è¯·"},
    {en:"good morning",cn:"æ—©ä¸Šå¥½"},
    {en:"good night",cn:"æ™šå®‰"},
    {en:"see you",cn:"å†è§"},
    {en:"yes",cn:"æ˜¯"},
    {en:"no",cn:"ä¸"},
    {en:"today",cn:"ä»Šå¤©"},
  ],
  "Day 2":[
    {en:"I",cn:"æˆ‘"},
    {en:"you",cn:"ä½ "},
    {en:"he",cn:"ä»–"},
    {en:"she",cn:"å¥¹"},
    {en:"we",cn:"æˆ‘ä»¬"},
    {en:"they",cn:"ä»–ä»¬"},
    {en:"my",cn:"æˆ‘çš„"},
    {en:"your",cn:"ä½ çš„"},
    {en:"his",cn:"ä»–çš„"},
    {en:"her",cn:"å¥¹çš„"},
  ],
  "Day 3":[
    {en:"eat",cn:"åƒ"},
    {en:"drink",cn:"å–"},
    {en:"go",cn:"å»"},
    {en:"come",cn:"æ¥"},
    {en:"like",cn:"å–œæ¬¢"},
    {en:"want",cn:"æƒ³è¦"},
    {en:"need",cn:"éœ€è¦"},
    {en:"help",cn:"å¸®åŠ©"},
    {en:"know",cn:"çŸ¥é“"},
    {en:"think",cn:"æƒ³"},
  ],
  "Day 4":[
    {en:"water",cn:"æ°´"},
    {en:"food",cn:"é£Ÿç‰©"},
    {en:"coffee",cn:"å’–å•¡"},
    {en:"tea",cn:"èŒ¶"},
    {en:"milk",cn:"ç‰›å¥¶"},
    {en:"rice",cn:"ç±³é¥­"},
    {en:"bread",cn:"é¢åŒ…"},
    {en:"fruit",cn:"æ°´æœ"},
    {en:"meat",cn:"è‚‰"},
    {en:"cake",cn:"è›‹ç³•"},
  ],
  "Day 5":[
    {en:"big",cn:"å¤§"},
    {en:"small",cn:"å°"},
    {en:"hot",cn:"çƒ­"},
    {en:"cold",cn:"å†·"},
    {en:"new",cn:"æ–°çš„"},
    {en:"old",cn:"æ—§çš„"},
    {en:"easy",cn:"å®¹æ˜“"},
    {en:"hard",cn:"éš¾"},
    {en:"fast",cn:"å¿«"},
    {en:"slow",cn:"æ…¢"},
  ],
  "Day 6":[
    {en:"I like coffee.",cn:"æˆ‘å–œæ¬¢å’–å•¡ã€‚"},
    {en:"I like tea.",cn:"æˆ‘å–œæ¬¢èŒ¶ã€‚"},
    {en:"I want water.",cn:"æˆ‘æƒ³è¦æ°´ã€‚"},
    {en:"I want food.",cn:"æˆ‘æƒ³è¦é£Ÿç‰©ã€‚"},
    {en:"I am happy.",cn:"æˆ‘å¾ˆå¼€å¿ƒã€‚"},
    {en:"I am tired.",cn:"æˆ‘ç´¯äº†ã€‚"},
    {en:"This is my phone.",cn:"è¿™æ˜¯æˆ‘çš„æ‰‹æœºã€‚"},
    {en:"This is my bag.",cn:"è¿™æ˜¯æˆ‘çš„åŒ…ã€‚"},
    {en:"I can do it.",cn:"æˆ‘å¯ä»¥åšåˆ°ã€‚"},
    {en:"Please help me.",cn:"è¯·å¸®å¸®æˆ‘ã€‚"},
  ],
  "Day 7":[
    {en:"How are you?",cn:"ä½ å¥½å—ï¼Ÿ"},
    {en:"I am fine.",cn:"æˆ‘å¾ˆå¥½ã€‚"},
    {en:"Nice to meet you.",cn:"å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚"},
    {en:"What is this?",cn:"è¿™æ˜¯ä»€ä¹ˆï¼Ÿ"},
    {en:"What is your name?",cn:"ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ"},
    {en:"Can you help me?",cn:"ä½ èƒ½å¸®æˆ‘å—ï¼Ÿ"},
    {en:"No problem.",cn:"æ²¡é—®é¢˜ã€‚"},
    {en:"Thank you very much.",cn:"éå¸¸æ„Ÿè°¢ä½ ã€‚"},
    {en:"See you tomorrow.",cn:"æ˜å¤©è§ã€‚"},
    {en:"Have a nice day.",cn:"ç¥ä½ ä»Šå¤©æ„‰å¿«ã€‚"},
  ],
  "Day 8":[
    {en:"Where are you from?",cn:"ä½ æ¥è‡ªå“ªé‡Œï¼Ÿ"},
    {en:"I am from China.",cn:"æˆ‘æ¥è‡ªä¸­å›½ã€‚"},
    {en:"I am busy today.",cn:"æˆ‘ä»Šå¤©å¾ˆå¿™ã€‚"},
    {en:"I am free now.",cn:"æˆ‘ç°åœ¨æœ‰ç©ºã€‚"},
    {en:"Letâ€™s go.",cn:"æˆ‘ä»¬èµ°å§ã€‚"},
    {en:"Take care.",cn:"ä¿é‡ã€‚"},
    {en:"Good luck.",cn:"ç¥ä½ å¥½è¿ã€‚"},
    {en:"Please speak slowly.",cn:"è¯·è¯´æ…¢ä¸€ç‚¹ã€‚"},
    {en:"Please repeat.",cn:"è¯·å†è¯´ä¸€éã€‚"},
    {en:"I understand.",cn:"æˆ‘æ˜ç™½ã€‚"},
  ],
  "Day 9":[
    {en:"How much is this?",cn:"è¿™ä¸ªå¤šå°‘é’±ï¼Ÿ"},
    {en:"It is cheap.",cn:"å®ƒå¾ˆä¾¿å®œã€‚"},
    {en:"It is expensive.",cn:"å®ƒå¾ˆè´µã€‚"},
    {en:"I like this one.",cn:"æˆ‘å–œæ¬¢è¿™ä¸ªã€‚"},
    {en:"I donâ€™t like it.",cn:"æˆ‘ä¸å–œæ¬¢å®ƒã€‚"},
    {en:"I will take it.",cn:"æˆ‘ä¹°äº†ã€‚"},
    {en:"Do you have a discount?",cn:"æœ‰æŠ˜æ‰£å—ï¼Ÿ"},
    {en:"Thatâ€™s fine.",cn:"å¯ä»¥ã€‚"},
    {en:"Too much.",cn:"å¤ªè´µäº†ã€‚"},
    {en:"Thank you.",cn:"è°¢è°¢ã€‚"},
  ],
  "Day 10":[
    {en:"I am learning English.",cn:"æˆ‘åœ¨å­¦è‹±è¯­ã€‚"},
    {en:"English is hard.",cn:"è‹±è¯­å¾ˆéš¾ã€‚"},
    {en:"English is easy.",cn:"è‹±è¯­å¾ˆç®€å•ã€‚"},
    {en:"Donâ€™t worry.",cn:"åˆ«æ‹…å¿ƒã€‚"},
    {en:"I can try.",cn:"æˆ‘å¯ä»¥è¯•è¯•ã€‚"},
    {en:"I will keep going.",cn:"æˆ‘ä¼šç»§ç»­åšæŒã€‚"},
    {en:"I need practice.",cn:"æˆ‘éœ€è¦ç»ƒä¹ ã€‚"},
    {en:"I practice every day.",cn:"æˆ‘æ¯å¤©ç»ƒä¹ ã€‚"},
    {en:"I am improving.",cn:"æˆ‘åœ¨è¿›æ­¥ã€‚"},
    {en:"Tomorrow will be better.",cn:"æ˜å¤©ä¼šæ›´å¥½ã€‚"},
  ],

  // ä¸ºäº†è®©æ–‡ä»¶ä¸çˆ†ç‚¸ï¼šDay 11-30 ç”¨ã€Œå®ç”¨å¥å­/è¯ã€ç»§ç»­è¡¥é½ï¼ˆæ¯ä¸€å¤©10æ¡ï¼‰
  "Day 11":[
    {en:"Where is the bathroom?",cn:"æ´—æ‰‹é—´åœ¨å“ªé‡Œï¼Ÿ"},
    {en:"Go straight.",cn:"ç›´èµ°ã€‚"},
    {en:"Turn left.",cn:"å·¦è½¬ã€‚"},
    {en:"Turn right.",cn:"å³è½¬ã€‚"},
    {en:"It is near.",cn:"å¾ˆè¿‘ã€‚"},
    {en:"It is far.",cn:"å¾ˆè¿œã€‚"},
    {en:"I am on my way.",cn:"æˆ‘åœ¨è·¯ä¸Šã€‚"},
    {en:"I am late.",cn:"æˆ‘è¿Ÿåˆ°äº†ã€‚"},
    {en:"Wait a moment.",cn:"ç­‰ä¸€ä¸‹ã€‚"},
    {en:"Hurry up.",cn:"å¿«ç‚¹ã€‚"},
  ],
  "Day 12":[
    {en:"What time is it?",cn:"ç°åœ¨å‡ ç‚¹ï¼Ÿ"},
    {en:"It is eight oâ€™clock.",cn:"å…«ç‚¹äº†ã€‚"},
    {en:"I get up early.",cn:"æˆ‘èµ·å¾—å¾ˆæ—©ã€‚"},
    {en:"I go to bed late.",cn:"æˆ‘ç¡å¾—å¾ˆæ™šã€‚"},
    {en:"I have breakfast.",cn:"æˆ‘åƒæ—©é¤ã€‚"},
    {en:"I have lunch.",cn:"æˆ‘åƒåˆé¥­ã€‚"},
    {en:"I have dinner.",cn:"æˆ‘åƒæ™šé¥­ã€‚"},
    {en:"I like reading.",cn:"æˆ‘å–œæ¬¢é˜…è¯»ã€‚"},
    {en:"I like music.",cn:"æˆ‘å–œæ¬¢éŸ³ä¹ã€‚"},
    {en:"I like sports.",cn:"æˆ‘å–œæ¬¢è¿åŠ¨ã€‚"},
  ],
  "Day 13":[
    {en:"It is sunny today.",cn:"ä»Šå¤©æ˜¯æ™´å¤©ã€‚"},
    {en:"It is rainy.",cn:"ä¸‹é›¨äº†ã€‚"},
    {en:"It is cloudy.",cn:"å¤šäº‘ã€‚"},
    {en:"It is windy.",cn:"æœ‰é£ã€‚"},
    {en:"It is hot.",cn:"å¾ˆçƒ­ã€‚"},
    {en:"It is cold.",cn:"å¾ˆå†·ã€‚"},
    {en:"I feel happy.",cn:"æˆ‘æ„Ÿåˆ°å¼€å¿ƒã€‚"},
    {en:"I feel tired.",cn:"æˆ‘æ„Ÿåˆ°ç´¯ã€‚"},
    {en:"I feel nervous.",cn:"æˆ‘æœ‰ç‚¹ç´§å¼ ã€‚"},
    {en:"I feel excited.",cn:"æˆ‘å¾ˆå…´å¥‹ã€‚"},
  ],
  "Day 14":[
    {en:"Can I have water?",cn:"æˆ‘å¯ä»¥è¦æ°´å—ï¼Ÿ"},
    {en:"Can I sit here?",cn:"æˆ‘å¯ä»¥åè¿™é‡Œå—ï¼Ÿ"},
    {en:"Please help me.",cn:"è¯·å¸®å¸®æˆ‘ã€‚"},
    {en:"Excuse me.",cn:"æ‰“æ‰°ä¸€ä¸‹ã€‚"},
    {en:"You are welcome.",cn:"ä¸å®¢æ°”ã€‚"},
    {en:"No, thanks.",cn:"ä¸ç”¨äº†ï¼Œè°¢è°¢ã€‚"},
    {en:"Yes, please.",cn:"å¥½çš„ï¼Œè¯·ã€‚"},
    {en:"I am ready.",cn:"æˆ‘å‡†å¤‡å¥½äº†ã€‚"},
    {en:"Letâ€™s start.",cn:"æˆ‘ä»¬å¼€å§‹å§ã€‚"},
    {en:"Good job!",cn:"åšå¾—å¥½ï¼"},
  ],
  "Day 15":[
    {en:"I like green.",cn:"æˆ‘å–œæ¬¢ç»¿è‰²ã€‚"},
    {en:"I like purple.",cn:"æˆ‘å–œæ¬¢ç´«è‰²ã€‚"},
    {en:"It is beautiful.",cn:"å®ƒå¾ˆæ¼‚äº®ã€‚"},
    {en:"It looks good.",cn:"å®ƒçœ‹èµ·æ¥å¾ˆå¥½ã€‚"},
    {en:"It is classic.",cn:"å®ƒå¾ˆç»å…¸ã€‚"},
    {en:"It is perfect.",cn:"å®ƒå¾ˆå®Œç¾ã€‚"},
    {en:"I love it.",cn:"æˆ‘çˆ±å®ƒã€‚"},
    {en:"I donâ€™t like it.",cn:"æˆ‘ä¸å–œæ¬¢å®ƒã€‚"},
    {en:"This one is better.",cn:"è¿™ä¸ªæ›´å¥½ã€‚"},
    {en:"That one is nice.",cn:"é‚£ä¸ªä¹Ÿä¸é”™ã€‚"},
  ],
  "Day 16":[
    {en:"I like my school.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„å­¦æ ¡ã€‚"},
    {en:"I like my teacher.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„è€å¸ˆã€‚"},
    {en:"I like my friends.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„æœ‹å‹ã€‚"},
    {en:"We study together.",cn:"æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ã€‚"},
    {en:"We play together.",cn:"æˆ‘ä»¬ä¸€èµ·ç©ã€‚"},
    {en:"I can read.",cn:"æˆ‘ä¼šè¯»ã€‚"},
    {en:"I can write.",cn:"æˆ‘ä¼šå†™ã€‚"},
    {en:"I can speak.",cn:"æˆ‘ä¼šè¯´ã€‚"},
    {en:"I can type.",cn:"æˆ‘ä¼šæ‰“å­—ã€‚"},
    {en:"I can learn.",cn:"æˆ‘ä¼šå­¦ä¹ ã€‚"},
  ],
  "Day 17":[
    {en:"I go to school by bus.",cn:"æˆ‘åå…¬äº¤å»ä¸Šå­¦ã€‚"},
    {en:"I go by bike.",cn:"æˆ‘éª‘è½¦å»ã€‚"},
    {en:"I go by car.",cn:"æˆ‘åè½¦å»ã€‚"},
    {en:"I walk to school.",cn:"æˆ‘èµ°è·¯ä¸Šå­¦ã€‚"},
    {en:"How do you go to school?",cn:"ä½ æ€ä¹ˆå»ä¸Šå­¦ï¼Ÿ"},
    {en:"I like English.",cn:"æˆ‘å–œæ¬¢è‹±è¯­ã€‚"},
    {en:"I like math.",cn:"æˆ‘å–œæ¬¢æ•°å­¦ã€‚"},
    {en:"I like science.",cn:"æˆ‘å–œæ¬¢ç§‘å­¦ã€‚"},
    {en:"English is useful.",cn:"è‹±è¯­å¾ˆæœ‰ç”¨ã€‚"},
    {en:"I will study hard.",cn:"æˆ‘ä¼šåŠªåŠ›å­¦ä¹ ã€‚"},
  ],
  "Day 18":[
    {en:"I have a question.",cn:"æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ã€‚"},
    {en:"What is the answer?",cn:"ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ"},
    {en:"Please give me an example.",cn:"è¯·ç»™æˆ‘ä¸€ä¸ªä¾‹å­ã€‚"},
    {en:"I will try again.",cn:"æˆ‘ä¼šå†è¯•ä¸€æ¬¡ã€‚"},
    {en:"I made a mistake.",cn:"æˆ‘çŠ¯äº†ä¸€ä¸ªé”™è¯¯ã€‚"},
    {en:"It is okay.",cn:"æ²¡å…³ç³»ã€‚"},
    {en:"No worries.",cn:"åˆ«æ‹…å¿ƒã€‚"},
    {en:"Keep going.",cn:"ç»§ç»­åŠ æ²¹ã€‚"},
    {en:"You can do it.",cn:"ä½ å¯ä»¥åšåˆ°ã€‚"},
    {en:"Great!",cn:"å¤ªæ£’äº†ï¼"},
  ],
  "Day 19":[
    {en:"What do you like?",cn:"ä½ å–œæ¬¢ä»€ä¹ˆï¼Ÿ"},
    {en:"I like reading books.",cn:"æˆ‘å–œæ¬¢çœ‹ä¹¦ã€‚"},
    {en:"I like drawing.",cn:"æˆ‘å–œæ¬¢ç”»ç”»ã€‚"},
    {en:"I like playing football.",cn:"æˆ‘å–œæ¬¢è¸¢è¶³çƒã€‚"},
    {en:"I like swimming.",cn:"æˆ‘å–œæ¬¢æ¸¸æ³³ã€‚"},
    {en:"I like dancing.",cn:"æˆ‘å–œæ¬¢è·³èˆã€‚"},
    {en:"I like singing.",cn:"æˆ‘å–œæ¬¢å”±æ­Œã€‚"},
    {en:"I like running.",cn:"æˆ‘å–œæ¬¢è·‘æ­¥ã€‚"},
    {en:"I like animals.",cn:"æˆ‘å–œæ¬¢åŠ¨ç‰©ã€‚"},
    {en:"I like nature.",cn:"æˆ‘å–œæ¬¢å¤§è‡ªç„¶ã€‚"},
  ],
  "Day 20":[
    {en:"What day is it today?",cn:"ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ"},
    {en:"It is Monday.",cn:"æ˜ŸæœŸä¸€ã€‚"},
    {en:"It is Tuesday.",cn:"æ˜ŸæœŸäºŒã€‚"},
    {en:"It is Wednesday.",cn:"æ˜ŸæœŸä¸‰ã€‚"},
    {en:"It is Thursday.",cn:"æ˜ŸæœŸå››ã€‚"},
    {en:"It is Friday.",cn:"æ˜ŸæœŸäº”ã€‚"},
    {en:"It is Saturday.",cn:"æ˜ŸæœŸå…­ã€‚"},
    {en:"It is Sunday.",cn:"æ˜ŸæœŸæ—¥ã€‚"},
    {en:"See you next time.",cn:"ä¸‹æ¬¡è§ã€‚"},
    {en:"Good night.",cn:"æ™šå®‰ã€‚"},
  ],
  "Day 21":[
    {en:"I want to improve my English.",cn:"æˆ‘æƒ³æé«˜æˆ‘çš„è‹±è¯­ã€‚"},
    {en:"I read every day.",cn:"æˆ‘æ¯å¤©é˜…è¯»ã€‚"},
    {en:"I listen every day.",cn:"æˆ‘æ¯å¤©å¬ã€‚"},
    {en:"I speak every day.",cn:"æˆ‘æ¯å¤©è¯´ã€‚"},
    {en:"I practice every day.",cn:"æˆ‘æ¯å¤©ç»ƒä¹ ã€‚"},
    {en:"Practice makes perfect.",cn:"ç†Ÿèƒ½ç”Ÿå·§ã€‚"},
    {en:"I will not give up.",cn:"æˆ‘ä¸ä¼šæ”¾å¼ƒã€‚"},
    {en:"I can do it.",cn:"æˆ‘å¯ä»¥åšåˆ°ã€‚"},
    {en:"I am getting better.",cn:"æˆ‘æ­£åœ¨å˜å¾—æ›´å¥½ã€‚"},
    {en:"I feel proud.",cn:"æˆ‘æ„Ÿåˆ°è‡ªè±ªã€‚"},
  ],
  "Day 22":[
    {en:"What do you want?",cn:"ä½ æƒ³è¦ä»€ä¹ˆï¼Ÿ"},
    {en:"I want some water.",cn:"æˆ‘æƒ³è¦ä¸€äº›æ°´ã€‚"},
    {en:"I want some bread.",cn:"æˆ‘æƒ³è¦ä¸€äº›é¢åŒ…ã€‚"},
    {en:"I want some fruit.",cn:"æˆ‘æƒ³è¦ä¸€äº›æ°´æœã€‚"},
    {en:"I want to rest.",cn:"æˆ‘æƒ³ä¼‘æ¯ã€‚"},
    {en:"I want to play.",cn:"æˆ‘æƒ³ç©ã€‚"},
    {en:"I want to learn.",cn:"æˆ‘æƒ³å­¦ä¹ ã€‚"},
    {en:"I want to help.",cn:"æˆ‘æƒ³å¸®å¿™ã€‚"},
    {en:"I want to try.",cn:"æˆ‘æƒ³è¯•è¯•ã€‚"},
    {en:"I want to win.",cn:"æˆ‘æƒ³èµ¢ã€‚"},
  ],
  "Day 23":[
    {en:"I am hungry.",cn:"æˆ‘é¥¿äº†ã€‚"},
    {en:"I am thirsty.",cn:"æˆ‘æ¸´äº†ã€‚"},
    {en:"I need a break.",cn:"æˆ‘éœ€è¦ä¼‘æ¯ã€‚"},
    {en:"Letâ€™s eat.",cn:"æˆ‘ä»¬åƒå§ã€‚"},
    {en:"Letâ€™s drink water.",cn:"æˆ‘ä»¬å–æ°´å§ã€‚"},
    {en:"Letâ€™s go home.",cn:"æˆ‘ä»¬å›å®¶å§ã€‚"},
    {en:"Letâ€™s go to the park.",cn:"æˆ‘ä»¬å»å…¬å›­å§ã€‚"},
    {en:"Letâ€™s study now.",cn:"æˆ‘ä»¬ç°åœ¨å­¦ä¹ å§ã€‚"},
    {en:"Letâ€™s do homework.",cn:"æˆ‘ä»¬å†™ä½œä¸šå§ã€‚"},
    {en:"Letâ€™s sleep.",cn:"æˆ‘ä»¬ç¡å§ã€‚"},
  ],
  "Day 24":[
    {en:"I have time.",cn:"æˆ‘æœ‰æ—¶é—´ã€‚"},
    {en:"I have no time.",cn:"æˆ‘æ²¡æ—¶é—´ã€‚"},
    {en:"I am early.",cn:"æˆ‘æ¥æ—©äº†ã€‚"},
    {en:"I am late.",cn:"æˆ‘è¿Ÿåˆ°äº†ã€‚"},
    {en:"I am ready.",cn:"æˆ‘å‡†å¤‡å¥½äº†ã€‚"},
    {en:"I am busy.",cn:"æˆ‘å¾ˆå¿™ã€‚"},
    {en:"I am free.",cn:"æˆ‘æœ‰ç©ºã€‚"},
    {en:"I am happy.",cn:"æˆ‘å¾ˆå¼€å¿ƒã€‚"},
    {en:"I am sad.",cn:"æˆ‘æœ‰ç‚¹éš¾è¿‡ã€‚"},
    {en:"I am okay.",cn:"æˆ‘æ²¡äº‹ã€‚"},
  ],
  "Day 25":[
    {en:"I like this one.",cn:"æˆ‘å–œæ¬¢è¿™ä¸ªã€‚"},
    {en:"I want this one.",cn:"æˆ‘æƒ³è¦è¿™ä¸ªã€‚"},
    {en:"How much is it?",cn:"å®ƒå¤šå°‘é’±ï¼Ÿ"},
    {en:"That is cheap.",cn:"é‚£å¾ˆä¾¿å®œã€‚"},
    {en:"That is expensive.",cn:"é‚£å¾ˆè´µã€‚"},
    {en:"Do you have a discount?",cn:"æœ‰æŠ˜æ‰£å—ï¼Ÿ"},
    {en:"I will take it.",cn:"æˆ‘ä¹°äº†ã€‚"},
    {en:"Thank you for your help.",cn:"è°¢è°¢ä½ çš„å¸®åŠ©ã€‚"},
    {en:"Have a nice day.",cn:"ç¥ä½ ä»Šå¤©æ„‰å¿«ã€‚"},
    {en:"See you tomorrow.",cn:"æ˜å¤©è§ã€‚"},
  ],
  "Day 26":[
    {en:"I like to learn.",cn:"æˆ‘å–œæ¬¢å­¦ä¹ ã€‚"},
    {en:"I like to practice.",cn:"æˆ‘å–œæ¬¢ç»ƒä¹ ã€‚"},
    {en:"I need practice.",cn:"æˆ‘éœ€è¦ç»ƒä¹ ã€‚"},
    {en:"I will keep practicing.",cn:"æˆ‘ä¼šç»§ç»­ç»ƒä¹ ã€‚"},
    {en:"I will try my best.",cn:"æˆ‘ä¼šå°½åŠ›ã€‚"},
    {en:"I will study hard.",cn:"æˆ‘ä¼šåŠªåŠ›å­¦ä¹ ã€‚"},
    {en:"I will be better.",cn:"æˆ‘ä¼šæ›´å¥½ã€‚"},
    {en:"I will not stop.",cn:"æˆ‘ä¸ä¼šåœã€‚"},
    {en:"I will not give up.",cn:"æˆ‘ä¸ä¼šæ”¾å¼ƒã€‚"},
    {en:"I will win.",cn:"æˆ‘ä¼šèµ¢ã€‚"},
  ],
  "Day 27":[
    {en:"I live here.",cn:"æˆ‘ä½åœ¨è¿™é‡Œã€‚"},
    {en:"I go home.",cn:"æˆ‘å›å®¶ã€‚"},
    {en:"I go to work.",cn:"æˆ‘å»ä¸Šç­ã€‚"},
    {en:"I go to school.",cn:"æˆ‘å»ä¸Šå­¦ã€‚"},
    {en:"I like my home.",cn:"æˆ‘å–œæ¬¢æˆ‘å®¶ã€‚"},
    {en:"I like my city.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„åŸå¸‚ã€‚"},
    {en:"I like my life.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„ç”Ÿæ´»ã€‚"},
    {en:"I like my job.",cn:"æˆ‘å–œæ¬¢æˆ‘çš„å·¥ä½œã€‚"},
    {en:"I like my family.",cn:"æˆ‘çˆ±æˆ‘çš„å®¶äººã€‚"},
    {en:"I love you.",cn:"æˆ‘çˆ±ä½ ã€‚"},
  ],
  "Day 28":[
    {en:"Today is a good day.",cn:"ä»Šå¤©æ˜¯ç¾å¥½çš„ä¸€å¤©ã€‚"},
    {en:"Tomorrow will be better.",cn:"æ˜å¤©ä¼šæ›´å¥½ã€‚"},
    {en:"I can do it.",cn:"æˆ‘å¯ä»¥åšåˆ°ã€‚"},
    {en:"I will keep going.",cn:"æˆ‘ä¼šç»§ç»­åšæŒã€‚"},
    {en:"I will keep practicing.",cn:"æˆ‘ä¼šç»§ç»­ç»ƒä¹ ã€‚"},
    {en:"Good luck!",cn:"ç¥ä½ å¥½è¿ï¼"},
    {en:"Great job!",cn:"åšå¾—å¥½ï¼"},
    {en:"Well done!",cn:"å¹²å¾—æ¼‚äº®ï¼"},
    {en:"Keep it up!",cn:"ç»§ç»­ä¿æŒï¼"},
    {en:"You are the best!",cn:"ä½ æœ€æ£’ï¼"},
  ],
  "Day 29":[
    {en:"What is your name?",cn:"ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ"},
    {en:"My name is Lily.",cn:"æˆ‘å«è‰è‰ã€‚"},
    {en:"How old are you?",cn:"ä½ å¤šå¤§äº†ï¼Ÿ"},
    {en:"I am twelve years old.",cn:"æˆ‘åäºŒå²ã€‚"},
    {en:"What do you like?",cn:"ä½ å–œæ¬¢ä»€ä¹ˆï¼Ÿ"},
    {en:"I like reading books.",cn:"æˆ‘å–œæ¬¢çœ‹ä¹¦ã€‚"},
    {en:"What time is it?",cn:"ç°åœ¨å‡ ç‚¹ï¼Ÿ"},
    {en:"It is eight oâ€™clock.",cn:"å…«ç‚¹äº†ã€‚"},
    {en:"Nice to meet you.",cn:"å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚"},
    {en:"See you later.",cn:"å›å¤´è§ã€‚"},
  ],
  "Day 30":[
    {en:"I can do it.",cn:"æˆ‘å¯ä»¥åšåˆ°ã€‚"},
    {en:"I will keep practicing.",cn:"æˆ‘ä¼šç»§ç»­ç»ƒä¹ ã€‚"},
    {en:"Tomorrow will be better.",cn:"æ˜å¤©ä¼šæ›´å¥½ã€‚"},
    {en:"I will not give up.",cn:"æˆ‘ä¸ä¼šæ”¾å¼ƒã€‚"},
    {en:"Practice makes perfect.",cn:"ç†Ÿèƒ½ç”Ÿå·§ã€‚"},
    {en:"I am improving.",cn:"æˆ‘åœ¨è¿›æ­¥ã€‚"},
    {en:"I feel proud.",cn:"æˆ‘æ„Ÿåˆ°è‡ªè±ªã€‚"},
    {en:"Thank you for your help.",cn:"è°¢è°¢ä½ çš„å¸®åŠ©ã€‚"},
    {en:"Good luck!",cn:"ç¥ä½ å¥½è¿ï¼"},
    {en:"Great job!",cn:"åšå¾—å¥½ï¼"},
  ],

  "å°å­¦å…­å¹´çº§":[
    // è¯æ±‡ï¼ˆå¸¸ç”¨ï¼‰
    {en:"apple",cn:"è‹¹æœ"},
    {en:"banana",cn:"é¦™è•‰"},
    {en:"book",cn:"ä¹¦"},
    {en:"teacher",cn:"è€å¸ˆ"},
    {en:"student",cn:"å­¦ç”Ÿ"},
    {en:"family",cn:"å®¶åº­"},
    {en:"school",cn:"å­¦æ ¡"},
    {en:"homework",cn:"ä½œä¸š"},
    {en:"computer",cn:"ç”µè„‘"},
    {en:"internet",cn:"äº’è”ç½‘"},
    {en:"holiday",cn:"å‡æœŸ"},
    {en:"travel",cn:"æ—…è¡Œ"},
    {en:"future",cn:"æœªæ¥"},
    {en:"important",cn:"é‡è¦çš„"},
    {en:"different",cn:"ä¸åŒçš„"},
    {en:"problem",cn:"é—®é¢˜"},
    {en:"answer",cn:"ç­”æ¡ˆ"},
    {en:"example",cn:"ä¾‹å­"},
    {en:"remember",cn:"è®°ä½"},
    {en:"improve",cn:"æé«˜"},

    // å¥å­ï¼ˆå…­å¹´çº§å¸¸ç”¨è¡¨è¾¾ï¼‰
    {en:"I want to improve my English.",cn:"æˆ‘æƒ³æé«˜æˆ‘çš„è‹±è¯­ã€‚"},
    {en:"It is important to read every day.",cn:"æ¯å¤©é˜…è¯»å¾ˆé‡è¦ã€‚"},
    {en:"We are different but we can be friends.",cn:"æˆ‘ä»¬ä¸åŒä½†å¯ä»¥åšæœ‹å‹ã€‚"},
    {en:"When I have a problem, I ask for help.",cn:"å½“æˆ‘æœ‰é—®é¢˜æ—¶æˆ‘ä¼šæ±‚åŠ©ã€‚"},
    {en:"Please give me an example.",cn:"è¯·ç»™æˆ‘ä¸€ä¸ªä¾‹å­ã€‚"},
    {en:"I want to be a doctor in the future.",cn:"æˆ‘å°†æ¥æƒ³å½“åŒ»ç”Ÿã€‚"},
    {en:"I do my homework after school.",cn:"æ”¾å­¦åæˆ‘åšä½œä¸šã€‚"},
    {en:"I go to school by bus.",cn:"æˆ‘åå…¬äº¤å»ä¸Šå­¦ã€‚"},
    {en:"Practice makes perfect.",cn:"ç†Ÿèƒ½ç”Ÿå·§ã€‚"},
    {en:"I will try my best.",cn:"æˆ‘ä¼šå°½åŠ›ã€‚"},
  ],

  "è‡ªå®šä¹‰":[]
};

/* =========================
   B) å­˜å‚¨ï¼šå¤ä¹ è®°å½• + æ˜Ÿæ˜Ÿ
   ========================= */
const LS_KEY = "ETP_APP_V2";
function loadState(){
  try{
    return JSON.parse(localStorage.getItem(LS_KEY) || "{}");
  }catch(e){ return {}; }
}
function saveState(s){
  localStorage.setItem(LS_KEY, JSON.stringify(s));
}

// state schema
// {
//   items: { "Day 1::hello": {star:true, wrong:1, right:2, lastAt:...}, ... },
//   starsTotal: number,
//   streak: number,
//   goal: number,
//   todayKey: "YYYY-MM-DD",
//   todayStars: number
// }
function ensureState(){
  const s = loadState();
  if(!s.items) s.items = {};
  if(typeof s.starsTotal !== "number") s.starsTotal = 0;
  if(typeof s.streak !== "number") s.streak = 0;
  if(typeof s.goal !== "number") s.goal = 20;
  if(typeof s.todayStars !== "number") s.todayStars = 0;

  const today = new Date();
  const k = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;
  if(s.todayKey !== k){
    s.todayKey = k;
    s.todayStars = 0;
    s.streak = 0; // æ–°çš„ä¸€å¤©è¿å‡»æ¸…é›¶ï¼ˆä¹Ÿå¯ä»¥ä¸æ¸…ï¼Œä½ æƒ³æ€æ ·éƒ½è¡Œï¼‰
  }

  saveState(s);
  return s;
}

let APP = ensureState();

function normalize(s){
  return (s || "").trim().replace(/\s+/g, " ").toLowerCase();
}
function itemKey(day, en){
  return `${day}::${en}`;
}
function getRec(day, en){
  const k = itemKey(day, en);
  if(!APP.items[k]){
    APP.items[k] = { star:false, wrong:0, right:0, lastAt:0 };
  }
  return APP.items[k];
}
function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"), 1400);
}

/* =========================
   C) UI + æ¨¡å¼
   ========================= */
const modeSelect = document.getElementById("modeSelect");
const enText = document.getElementById("enText");
const cnText = document.getElementById("cnText");
const inputEl = document.getElementById("inputEl");
const hintEl = document.getElementById("hintEl");

const posEl = document.getElementById("posEl");
const totalEl = document.getElementById("totalEl");
const correctEl = document.getElementById("correctEl");
const wrongEl = document.getElementById("wrongEl");
const accEl = document.getElementById("accEl");
const barEl = document.getElementById("barEl");

const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const speakBtn = document.getElementById("speakBtn");
const markBtn = document.getElementById("markBtn");
const resetBtn = document.getElementById("resetBtn");

const customArea = document.getElementById("customArea");
const loadCustomBtn = document.getElementById("loadCustomBtn");
const clearCustomBtn = document.getElementById("clearCustomBtn");
const clearAllBtn = document.getElementById("clearAllBtn");

const markCount = document.getElementById("markCount");
const wrongCount = document.getElementById("wrongCount");
const modeName = document.getElementById("modeName");
const reviewList = document.getElementById("reviewList");

const starTotal = document.getElementById("starTotal");
const streakEl = document.getElementById("streakEl");
const goalEl = document.getElementById("goalEl");
const setGoalBtn = document.getElementById("setGoalBtn");
const clearStarsBtn = document.getElementById("clearStarsBtn");

// app run state
let currentMode = "Day 1";
let currentDayForReview = "Day 1";
let activeList = []; // {day,en,cn}
let pos = 0;

let correct = 0;
let wrong = 0;

function rebuildModeSelect(){
  modeSelect.innerHTML = "";

  Object.keys(DAYS).forEach(k=>{
    const opt = document.createElement("option");
    opt.value = k;
    opt.textContent = k;
    modeSelect.appendChild(opt);
  });

  const opt1 = document.createElement("option");
  opt1.value = "__review_day__";
  opt1.textContent = "å¤ä¹ ï¼ˆå½“å¤©ä¸ç†Ÿç»ƒï¼‰";
  modeSelect.appendChild(opt1);

  const opt2 = document.createElement("option");
  opt2.value = "__review_all__";
  opt2.textContent = "å¤ä¹ ï¼ˆå…¨å±€ä¸ç†Ÿç»ƒï¼‰";
  modeSelect.appendChild(opt2);
}

function buildReview(scope, day){
  const out = [];
  const keys = (scope==="day") ? [day] : Object.keys(DAYS);

  keys.forEach(d=>{
    (DAYS[d]||[]).forEach(it=>{
      const r = getRec(d, it.en);
      if(r.star || r.wrong>0){
        out.push({day:d, en:it.en, cn:it.cn});
      }
    });
  });

  // sort: wrong desc, star first
  out.sort((a,b)=>{
    const ra = getRec(a.day, a.en);
    const rb = getRec(b.day, b.en);
    if(rb.wrong !== ra.wrong) return rb.wrong - ra.wrong;
    if((rb.star?1:0) !== (ra.star?1:0)) return (rb.star?1:0) - (ra.star?1:0);
    return a.en.localeCompare(b.en);
  });

  return out;
}

function buildActiveList(){
  if(currentMode === "__review_day__"){
    activeList = buildReview("day", currentDayForReview);
  }else if(currentMode === "__review_all__"){
    activeList = buildReview("all");
  }else{
    currentDayForReview = currentMode;
    activeList = (DAYS[currentMode]||[]).map(x=>({day:currentMode, en:x.en, cn:x.cn}));
  }
}

function updateStatsUI(){
  correctEl.textContent = String(correct);
  wrongEl.textContent = String(wrong);
  const total = correct + wrong;
  const acc = total===0 ? 0 : Math.round(correct/total*100);
  accEl.textContent = acc + "%";
}

function updateProgressUI(){
  const total = activeList.length;
  totalEl.textContent = String(total);
  posEl.textContent = total===0 ? "0" : String(Math.min(pos+1,total));
  const pct = total===0 ? 0 : Math.round((pos/Math.max(1,total))*100);
  barEl.style.width = pct + "%";
}

function updateRewardUI(){
  starTotal.textContent = String(APP.starsTotal);
  streakEl.textContent = String(APP.streak);
  goalEl.textContent = String(APP.goal);
}

function updateSidePanel(){
  let mc = 0, wc = 0;
  Object.values(APP.items).forEach(v=>{
    if(v.star) mc++;
    if(v.wrong>0) wc++;
  });
  markCount.textContent = String(mc);
  wrongCount.textContent = String(wc);

  let name = currentMode;
  if(currentMode==="__review_day__") name = `å¤ä¹ ï¼ˆå½“å¤©ä¸ç†Ÿç»ƒï¼š${currentDayForReview}ï¼‰`;
  if(currentMode==="__review_all__") name = "å¤ä¹ ï¼ˆå…¨å±€ä¸ç†Ÿç»ƒï¼‰";
  modeName.textContent = name;

  // list shown: day review unless all-review
  const listToShow = (currentMode==="__review_all__")
    ? buildReview("all")
    : buildReview("day", currentDayForReview);

  reviewList.innerHTML = "";
  if(listToShow.length===0){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `<div class="a">æš‚æ— ä¸ç†Ÿç»ƒå†…å®¹</div><div class="b">åšé”™æˆ–ç‚¹ â­ åï¼Œä¼šè‡ªåŠ¨å‡ºç°åœ¨è¿™é‡Œ</div>`;
    reviewList.appendChild(div);
    return;
  }

  listToShow.slice(0,80).forEach(it=>{
    const r = getRec(it.day, it.en);
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="a">${it.en}</div>
      <div class="b">${it.cn} <span class="soft">ï¼ˆ${it.day}ï¼‰</span></div>
      <div class="meta">
        <span class="tag ${r.star ? "ok" : ""}">${r.star ? "â­å·²æ ‡è®°" : "æœªæ ‡è®°"}</span>
        <span class="tag ${r.wrong>0 ? "bad" : ""}">âŒé”™è¯¯ ${r.wrong}</span>
        <span class="tag">âœ…æ­£ç¡® ${r.right||0}</span>
      </div>
    `;
    reviewList.appendChild(div);
  });
}

function currentItem(){
  if(activeList.length===0) return null;
  return activeList[pos];
}

function render(){
  buildActiveList();
  pos = 0;
  correct = 0;
  wrong = 0;

  updateRewardUI();
  updateStatsUI();
  updateSidePanel();

  if(activeList.length===0){
    enText.textContent = "ï¼ˆæ²¡æœ‰å†…å®¹ï¼‰";
    cnText.textContent = "è¿™ä¸ªåˆ—è¡¨ä¸ºç©ºï¼šå…ˆç»ƒä¹ å¹¶åšé”™/æ ‡è®°ä¸€äº›ï¼Œå†è¿›å…¥å¤ä¹ ã€‚";
    inputEl.value = "";
    inputEl.disabled = true;
    hintEl.innerHTML = `<span class="soft">åˆ‡æ¢åˆ° Day æˆ– å°å­¦å…­å¹´çº§ å¼€å§‹ç»ƒä¹ ã€‚</span>`;
    updateProgressUI();
    markBtn.disabled = true;
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }

  inputEl.disabled = false;
  markBtn.disabled = false;
  prevBtn.disabled = false;
  nextBtn.disabled = false;

  const it = currentItem();
  enText.textContent = it.en;
  cnText.textContent = it.cn;
  inputEl.value = "";
  hintEl.innerHTML = `<span class="soft">å¼€å§‹è¾“å…¥è‹±æ–‡â€¦ï¼ˆå¿½ç•¥å¤§å°å†™/å¤šç©ºæ ¼ï¼‰</span>`;
  updateProgressUI();
  inputEl.focus();

  const r = getRec(it.day, it.en);
  markBtn.textContent = r.star ? "â­ å·²åŠ å…¥å¤ä¹ ï¼ˆç‚¹å–æ¶ˆï¼‰" : "â­ åŠ å…¥å¤ä¹ ";
}

function goNext(){
  if(activeList.length===0) return;
  if(pos < activeList.length-1){
    pos++;
    const it = currentItem();
    enText.textContent = it.en;
    cnText.textContent = it.cn;
    inputEl.value = "";
    hintEl.innerHTML = `<span class="soft">å¼€å§‹è¾“å…¥è‹±æ–‡â€¦</span>`;
    updateProgressUI();
    inputEl.focus();

    const r = getRec(it.day, it.en);
    markBtn.textContent = r.star ? "â­ å·²åŠ å…¥å¤ä¹ ï¼ˆç‚¹å–æ¶ˆï¼‰" : "â­ åŠ å…¥å¤ä¹ ";
  }else{
    enText.textContent = "ğŸ‰ å®Œæˆï¼";
    cnText.textContent = "æœ¬åˆ—è¡¨å·²ç»ƒå®Œã€‚å¯ä»¥åˆ‡æ¢å¤©æ•°æˆ–è¿›å…¥å¤ä¹ ã€‚";
    hintEl.innerHTML = `<span class="ok">å®Œæˆï¼</span> <span class="soft">å»å¤ä¹ å·©å›ºè–„å¼±é¡¹å§ã€‚</span>`;
    inputEl.value = "";
    inputEl.disabled = true;
    barEl.style.width = "100%";
  }
}

function goPrev(){
  if(activeList.length===0) return;
  if(pos > 0){
    pos--;
    const it = currentItem();
    enText.textContent = it.en;
    cnText.textContent = it.cn;
    inputEl.value = "";
    hintEl.innerHTML = `<span class="soft">å¼€å§‹è¾“å…¥è‹±æ–‡â€¦</span>`;
    updateProgressUI();
    inputEl.focus();

    const r = getRec(it.day, it.en);
    markBtn.textContent = r.star ? "â­ å·²åŠ å…¥å¤ä¹ ï¼ˆç‚¹å–æ¶ˆï¼‰" : "â­ åŠ å…¥å¤ä¹ ";
  }
}

function speak(){
  const it = currentItem();
  if(!it) return;
  if(!("speechSynthesis" in window)){
    alert("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒæœ—è¯»ï¼Œè¯·ç”¨ Chrome/Edgeã€‚");
    return;
  }
  const u = new SpeechSynthesisUtterance(it.en);
  u.lang = "en-US";
  u.rate = 0.95;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

function toggleStar(){
  const it = currentItem();
  if(!it) return;
  const r = getRec(it.day, it.en);
  r.star = !r.star;
  r.lastAt = Date.now();
  saveState(APP);

  markBtn.textContent = r.star ? "â­ å·²åŠ å…¥å¤ä¹ ï¼ˆç‚¹å–æ¶ˆï¼‰" : "â­ åŠ å…¥å¤ä¹ ";
  updateSidePanel();
  toast(r.star ? "å·²åŠ å…¥å¤ä¹  â­" : "å·²å–æ¶ˆæ ‡è®°");
}

function resetCurrent(){
  correct = 0; wrong = 0; pos = 0;
  inputEl.disabled = false;
  render();
}

function clearAllRecords(){
  if(!confirm("ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°å½•ï¼ˆæ˜Ÿæ ‡/é”™è¯¯æ¬¡æ•°/æ­£ç¡®æ¬¡æ•°ï¼‰å—ï¼Ÿ")) return;
  APP.items = {};
  saveState(APP);
  render();
}

function addStars(amount){
  APP.starsTotal += amount;
  APP.todayStars += amount;
  saveState(APP);
  updateRewardUI();

  // è¾¾æˆç›®æ ‡
  if(APP.todayStars >= APP.goal){
    toast(`ğŸ‰ è¾¾æˆç›®æ ‡ï¼ä»Šå¤©å·²è·å¾— ${APP.todayStars} â­`);
  }
}

function onCorrect(){
  // æ˜Ÿæ˜Ÿå¥–åŠ±ï¼šåŸºç¡€1ï¼Œè¿å‡»åŠ æˆï¼ˆæœ€å¤š+3ï¼‰
  APP.streak = Math.min(10, (APP.streak||0) + 1);
  const bonus = Math.min(3, Math.floor(APP.streak/3)); // 0~3
  const gain = 1 + bonus;
  addStars(gain);

  if(gain >= 3) toast(`ğŸ”¥ è¿å‡» ${APP.streak}ï¼+${gain}â­`);
}

function onWrong(){
  APP.streak = 0; // é”™äº†è¿å‡»æ¸…é›¶
  saveState(APP);
  updateRewardUI();
}

setGoalBtn.addEventListener("click", ()=>{
  const v = prompt("è®¾ç½®ä»Šæ—¥ç›®æ ‡ï¼ˆæ˜Ÿæ˜Ÿæ•°ï¼‰", String(APP.goal));
  if(v===null) return;
  const n = parseInt(v, 10);
  if(!Number.isFinite(n) || n<=0){
    alert("è¯·è¾“å…¥å¤§äº0çš„æ•°å­—");
    return;
  }
  APP.goal = n;
  saveState(APP);
  updateRewardUI();
  toast(`ä»Šæ—¥ç›®æ ‡å·²è®¾ä¸º ${n} â­`);
});

clearStarsBtn.addEventListener("click", ()=>{
  if(!confirm("ç¡®å®šæ¸…ç©ºæ˜Ÿæ˜Ÿå—ï¼Ÿï¼ˆæ€»æ˜Ÿæ˜Ÿä¼šå½’é›¶ï¼‰")) return;
  APP.starsTotal = 0;
  APP.todayStars = 0;
  APP.streak = 0;
  saveState(APP);
  updateRewardUI();
  toast("å·²æ¸…ç©ºæ˜Ÿæ˜Ÿ");
});

/* =========================
   è¾“å…¥åˆ¤æ–­ï¼ˆå®æ—¶ï¼‰+ Enter æäº¤ï¼ˆè®°å½•é”™è¯¯ï¼‰
   ========================= */
inputEl.addEventListener("input", ()=>{
  const it = currentItem();
  if(!it) return;

  const target = normalize(it.en);
  const typed = normalize(inputEl.value);

  if(typed.length === 0){
    hintEl.innerHTML = `<span class="soft">å¼€å§‹è¾“å…¥è‹±æ–‡â€¦</span>`;
    return;
  }

  if(typed === target){
    hintEl.innerHTML = `<span class="ok">âœ” æ­£ç¡®ï¼</span> <span class="soft">0.5ç§’åä¸‹ä¸€æ¡</span>`;
    correct++;
    updateStatsUI();

    const r = getRec(it.day, it.en);
    r.right = (r.right||0) + 1;
    r.lastAt = Date.now();
    saveState(APP);

    onCorrect();
    updateSidePanel();

    setTimeout(()=>{
      if(inputEl.disabled) return;
      goNext();
      updateProgressUI();
    }, 500);
  }else{
    hintEl.innerHTML = `<span class="bad">âœ– ç»§ç»­è¾“å…¥â€¦</span> <span class="soft">ï¼ˆæ‹¼å†™/å°‘å­—/å¤šå­—ï¼‰</span>`;
  }
});

inputEl.addEventListener("keydown",(e)=>{
  if(e.key === "Enter"){
    e.preventDefault();
    const it = currentItem();
    if(!it) return;

    const target = normalize(it.en);
    const typed = normalize(inputEl.value);

    if(typed !== target){
      wrong++;
      updateStatsUI();

      const r = getRec(it.day, it.en);
      r.wrong = (r.wrong||0) + 1;
      r.lastAt = Date.now();
      saveState(APP);

      onWrong();
      updateSidePanel();

      hintEl.innerHTML = `<span class="bad">âœ– ä¸å¯¹å“¦</span> <span class="soft">ï¼ˆå·²è®°å½•é”™è¯¯æ¬¡æ•°ï¼Œå»ºè®®ç‚¹ â­ åŠ å…¥å¤ä¹ ï¼‰</span>`;
      toast("å·²è®°å½•é”™è¯¯ âŒ");
    }
  }
});

/* =========================
   è‡ªå®šä¹‰å†…å®¹
   ========================= */
loadCustomBtn.addEventListener("click", ()=>{
  const lines = customArea.value.split("\n").map(l=>l.trim()).filter(Boolean);
  const arr = [];
  for(const line of lines){
    const parts = line.split("=");
    if(parts.length < 2) continue;
    const en = parts[0].trim();
    const cn = parts.slice(1).join("=").trim();
    if(en && cn) arr.push({en, cn});
  }
  DAYS["è‡ªå®šä¹‰"] = arr;

  rebuildModeSelect();
  currentMode = "è‡ªå®šä¹‰";
  modeSelect.value = "è‡ªå®šä¹‰";
  currentDayForReview = "è‡ªå®šä¹‰";
  render();
  toast("å·²åŠ è½½è‡ªå®šä¹‰å†…å®¹ âœ…");
});

clearCustomBtn.addEventListener("click", ()=>{
  if(!confirm("ç¡®å®šæ¸…ç©ºè‡ªå®šä¹‰å†…å®¹å—ï¼Ÿ")) return;
  customArea.value = "";
  DAYS["è‡ªå®šä¹‰"] = [];
  rebuildModeSelect();
  if(currentMode === "è‡ªå®šä¹‰") render();
  toast("å·²æ¸…ç©ºè‡ªå®šä¹‰");
});

/* =========================
   mode change + buttons
   ========================= */
modeSelect.addEventListener("change", ()=>{
  currentMode = modeSelect.value;
  render();
});

prevBtn.addEventListener("click", goPrev);
nextBtn.addEventListener("click", goNext);
speakBtn.addEventListener("click", speak);
markBtn.addEventListener("click", toggleStar);
resetBtn.addEventListener("click", resetCurrent);
clearAllBtn.addEventListener("click", clearAllRecords);

/* =========================
   init
   ========================= */
function init(){
  rebuildModeSelect();
  if(!DAYS[currentMode]) currentMode = "Day 1";
  modeSelect.value = currentMode;
  render();
}
init();
</script>
</body>
</html>
